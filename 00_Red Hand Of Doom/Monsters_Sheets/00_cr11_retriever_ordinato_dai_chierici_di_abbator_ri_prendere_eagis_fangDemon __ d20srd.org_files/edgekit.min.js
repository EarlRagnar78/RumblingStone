!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){function e(){return e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},e.apply(this,arguments)}var t=function(){return t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},t.apply(this,arguments)};function n(e,t,n,r){return new(n||(n=Promise))(function(i,o){function u(e){try{a(r.next(e))}catch(e){o(e)}}function s(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(u,s)}a((r=r.apply(e,t||[])).next())})}function r(e,t){var n,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((i=(i=u.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(e,u)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function i(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],u=0,s=o.length;u<s;u++,i++)r[i]=o[u];return r}var o,u,s=function(){return Math.round(Date.now()/1e3)},a=function(e,t){try{var n=JSON.stringify(t);localStorage.setItem(e,n)}catch(e){}},c=function(e){var t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(e){return}};!function(e){e.COSINE_SIMILARITY="cosineSimilarity",e.LOGISTIC_REGRESSION="logisticRegression"}(o||(o={})),function(e){e.PAGE_VIEWS="edkt_page_views",e.MATCHED_AUDIENCES="edkt_matched_audiences",e.MATCHED_AUDIENCE_IDS="edkt_matched_audience_ids",e.CACHED_AUDIENCES="edkt_cached_audiences",e.CACHED_AUDIENCE_META_DATA="edkt_cached_audience_meta_data"}(u||(u={}));var d,h,f,l=new(function(){function e(){this.pageViews=[],this.storageSize=300,this._load()}return e.prototype._load=function(){this.pageViews=c(u.PAGE_VIEWS)||[]},e.prototype._save=function(){a(u.PAGE_VIEWS,this.pageViews)},e.prototype._trim=function(){this.pageViews.length<=this.storageSize||(this.pageViews.sort(function(e,t){return t.ts-e.ts}),this.pageViews=this.pageViews.slice(0,this.storageSize))},e.prototype.setStorageSize=function(e){!e||e<0||(this.storageSize=e)},e.prototype.savePageView=function(e,n){if(e&&!(Object.keys(e).length<1)){var r=s(),i=t({ts:r,features:e},n);this.pageViews.push(i),this._trim(),this._save()}},e.prototype.getCopyOfPageViews=function(){return i(this.pageViews)},e}()),v=new(function(){function e(){this.matchedAudiences={},this.matchedAudienceIds=[],this.unsetDueToVersionIncAudienceIds=[],this.storeLoadedAt=s(),this._load()}return e.prototype._save=function(){a(u.MATCHED_AUDIENCES,this.matchedAudiences),a(u.MATCHED_AUDIENCE_IDS,this.matchedAudienceIds)},e.prototype._hasAudienceExpired=function(e){return e<this.storeLoadedAt},e.prototype._unsetAudience=function(e){delete this.matchedAudiences[e]},e.prototype._updatePageViewFlag=function(e,t){this.matchedAudiences[e].matchedOnCurrentPageView=t},e.prototype._load=function(){var e=this,t=c(u.MATCHED_AUDIENCES)||{};Array.isArray(t)&&(function(e){try{localStorage.removeItem(e)}catch(e){}}(u.MATCHED_AUDIENCES),t=t.reduce(function(e,t){e[t.id]=t},{})),this.matchedAudiences=t,Object.entries(t).forEach(function(t){var n=t[0];e._hasAudienceExpired(t[1].expiresAt)?e._unsetAudience(n):e._updatePageViewFlag(n,!1)}),this.matchedAudienceIds=Object.keys(this.matchedAudiences),this._save()},e.prototype.unsetAudiencesIfVersionIncremented=function(e){var t=this;e.forEach(function(e){var n=t.matchedAudiences[e.id]?t.matchedAudiences[e.id].version:null;n&&n<e.version&&(t._unsetAudience(e.id),t.unsetDueToVersionIncAudienceIds.push(e.id))})},e.prototype.isMatched=function(e,t){return!!(this.matchedAudiences[e]&&this.matchedAudiences[e].version>=t)},e.prototype.setAudiences=function(e){var t=this;e.forEach(function(e){t.matchedAudiences[e.id]=e,t.unsetDueToVersionIncAudienceIds.includes(e.id)&&t._updatePageViewFlag(e.id,!1)}),this.matchedAudienceIds=Object.keys(this.matchedAudiences),this._save()},e.prototype.getMatchedAudiences=function(){return Object.entries(this.matchedAudiences).map(function(e){return e[1]})},e}()),p={__proto__:null,count:function(){return function(e){return e.length}}},m={__proto__:null,eq:function(e){return function(t){return e===t}},gt:function(e){return function(t){return t>e}},lt:function(e){return function(t){return t<e}},ge:function(e){return function(t){return t>=e}},le:function(e){return function(t){return t<=e}}},g=function(e){return Math.sqrt(e.reduce(function(e,t){return e+Math.pow(t,2)},0))},_=function(e,t){return e.reduce(function(e,n,r){return e+n*t[r]},0)},y=function(e){return e instanceof Array&&e.every(function(e){return"number"==typeof e})},E=function(e,t){return function(e){return e.queryFilterComparisonType===o.COSINE_SIMILARITY&&y((t=e.queryValue).vector)&&"number"==typeof t.threshold;var t}(e)&&y(t.value)&&function(e,t){return t.length===e.vector.length&&((i=(_(n=t,r=e.vector)/(g(n)*g(r))- -.5)/1.4)>=1?1:i<=0?0:i)>e.threshold;var n,r,i}(e.queryValue,t.value)},A=function(e,t){return function(e){return e.queryFilterComparisonType===o.LOGISTIC_REGRESSION&&y((t=e.queryValue).vector)&&"number"==typeof t.threshold&&"number"==typeof t.bias;var t}(e)&&y(t.value)&&function(e,t){return t.length===e.vector.length&&(n=_(e.vector,t)+e.bias,1/(1+Math.exp(-n))>e.threshold);var n}(e.queryValue,t.value)},I=function(e,t){var n=t.vendor;return!!n&&e.length>0&&e.every(function(e){return!!n.consents[e]})},w=function(e){return new Promise(function(t){e.listenerId&&window.__tcfapi("removeEventListener",2,function(e){return t(e)},e.listenerId)})},S=function(){return Promise.race([new Promise(function(e){var t=null;t=window.setInterval(function(){window.__tcfapi&&(t&&window.clearInterval(t),e(!0))},100)}),new Promise(function(e,t){setTimeout(function(){return t(new Error("TCF API is missing"))},1e4)})])},P=function(e){return void 0===e&&(e=[]),n(void 0,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,S()];case 1:return t.sent(),[2,new Promise(function(t,n){window.__tcfapi?window.__tcfapi("addEventListener",2,function(n,r){!r||"loaded"!==n.cmpStatus||"tcloaded"!==n.eventStatus&&"useractioncomplete"!==n.eventStatus||(t(I(e,n)),w(n))}):n(new Error("TCF API is missing"))})]}})})},b=function(){return v.getMatchedAudiences()},T=function(){return l.getCopyOfPageViews()},D=(d=/edktDebug=true/.test(window.location.href),h=function(){var e;d&&(e=console).debug.apply(e,["Edgekit"].concat([].slice.call(arguments)))},h.isActive=d,h),O=(f=window,function(){var e,t,n=function(e){try{if(!e.location.ancestorOrigins)return;return e.location.ancestorOrigins}catch(e){return}}(f),r=!1,i=0,o=!1,u=!1;do{var s=e,a=u,c=void 0,d=!1,h=null;u=!1,e=e?e.parent:f;try{c=e.location.href||null}catch(e){d=!0}if(d)if(a){var l=s.context;try{t=h=l.sourceUrl,o=!0,e===f.top&&(r=!0)}catch(e){}}else{D("Trying to access cross domain iframe. Continuing without referrer and location");try{var v=s.document.referrer;v&&(h=v,e===f.top&&(r=!0))}catch(e){}!h&&n&&n[i-1]&&(h=n[i-1]),h&&!o&&(t=h)}else c&&(t=h=c,o=!1,e===f.top&&(r=!0)),e.context&&e.context.sourceUrl&&(u=!0);i+=1}while(e!==f.top);return{referer:t||null,reachedTop:r,isAmp:o}}),C=function(){return O().referer.split(/[?#]/)[0]},x=function(){var e;return"browsingTopics"in document&&(null==(e=document.featurePolicy)?void 0:e.allowsFeature("browsing-topics"))},k=function(){try{var e=x();return Promise.resolve(!1===e?{topics:[],supported:e,error:!1,message:null}:function(t,n){try{var r=Promise.resolve(document.browsingTopics()).then(function(t){return D("Topics fetched:",t),{topics:t,supported:e,error:!1,message:null}})}catch(e){return n(e)}return r&&r.then?r.then(void 0,n):r}(0,function(t){return D("Error fetching topics:",t),{topics:[],supported:e,error:!0,message:String(t)}}))}catch(e){return Promise.reject(e)}};function N(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}var M=function(t,n,r){try{return Promise.resolve(N(function(){var i,o=e({method:"GET",headers:{Accept:"application/json","X-Edkt-Load-Id":r,"X-Edkt-Api-Key":n}},x()?{browsingTopics:!0}:{});return Promise.resolve(fetch(t,o)).then(function(e){return e.ok||(i={code:e.status,message:e.statusText}),Promise.resolve(e.json()).then(function(e){return{error:i,data:e}})})},function(e){return D("GET Error:",e),{error:{code:void 0,message:String(e)},data:void 0}}))}catch(e){return Promise.reject(e)}},V=function(t,n,r,i){try{return Promise.resolve(N(function(){var o,u=e({method:"POST",headers:{"Content-Type":"application/json","X-Edkt-Load-Id":i,"X-Edkt-Api-Key":r},body:n},x()?{browsingTopics:!0}:{});return Promise.resolve(fetch(t,u)).then(function(e){return e.ok||(o={code:e.status,message:e.statusText}),Promise.resolve(e.json()).then(function(e){return{error:o,data:e}})})},function(e){return D("POST Error:",e),{error:{code:void 0,message:String(e)},data:void 0}}))}catch(e){return Promise.reject(e)}};D({API_URL:"https://api.edkt.io",CDN_URL:"https://cdn.edkt.io",ANALYTICS_API_URL:""});var L="https://api.edkt.io/analytics",j=L+"/bids";new function(){var e=this;this.TODAY=void 0,this.ONE_DAY=void 0,this.ONE_WEEK=void 0,this.ONE_WEEK_AGO=void 0,this.YESTERDAY=void 0,this.SNAPSHOT_DATE_KEY=void 0,this.hasSnapshotSentToday=void 0,this._hasSnapshotSentToday=function(){var t=Number(localStorage.getItem(e.SNAPSHOT_DATE_KEY))||null;return!(!t||t<e.TODAY)},this._setSnapshotSentDate=function(){var t=e.TODAY.toString();localStorage.setItem(e.SNAPSHOT_DATE_KEY,t)},this._timeStampToMillis=function(e){return 1e3*e},this._isTimeStampYesterday=function(t){return t<e.TODAY&&t>e.YESTERDAY},this._isTimeStampInPastWeek=function(t){return t<e.TODAY&&t>e.ONE_WEEK_AGO},this.get=function(){if(e.hasSnapshotSentToday)return null;var t=T(),n=t.length,r=t.filter(function(t){var n=e._timeStampToMillis(t.ts);return e._isTimeStampYesterday(n)}).length,i=t.filter(function(t){var n=e._timeStampToMillis(t.ts);return e._isTimeStampInPastWeek(n)}).length;return e._setSnapshotSentDate(),{totalPageViews:n,pageViewsYesterday:r,pageViewsInPastWeek:i}},this.TODAY=(new Date).setUTCHours(0,0,0,0),this.ONE_DAY=864e5,this.ONE_WEEK=7*this.ONE_DAY,this.ONE_WEEK_AGO=this.TODAY-this.ONE_WEEK,this.YESTERDAY=this.TODAY-this.ONE_DAY,this.SNAPSHOT_DATE_KEY="edkt_snapshot_date",this.hasSnapshotSentToday=this._hasSnapshotSentToday()};var Y=/*#__PURE__*/function(){function e(t){this.loadId=void 0,this.pageViews=void 0,this.previousSampledLoadId=void 0,this.matchedAudienceIds=void 0,this.loadId=t,this.pageViews=T(),this.previousSampledLoadId=e._getPreviousSampledLoadId(),this.matchedAudienceIds=e._loadMatchedAudienceIds()}e._getPreviousSampledLoadId=function(){return localStorage.getItem(this.SAMPLED_LOAD_ID_KEY)||null},e._loadMatchedAudienceIds=function(){var e=localStorage.getItem(this.MATCHED_AUDIENCE_IDS_KEY);return e?JSON.parse(e):[]},e._setLastSampledLoadId=function(e){localStorage.setItem(this.SAMPLED_LOAD_ID_KEY,e)},e._includeInSample=function(){return Math.random()<this.SAMPLE_RATE};var t=e.prototype;return t._createSequence=function(){return this.pageViews.filter(function(e){return!(!e.ts||!e.kh||void 0===e.kh)}).map(function(e){return{ts:e.ts,kh:e.kh,tr:null}})},t.get=function(t){if(t||!(this.pageViews.length<=e.MIN_SEQUENCE_LENGTH))return t||e._includeInSample()?(e._setLastSampledLoadId(this.loadId),{sl:this.previousSampledLoadId,sq:this._createSequence(),ma:this.matchedAudienceIds}):void 0},e}();Y.SAMPLED_LOAD_ID_KEY="edkt_sampled_load_id",Y.MATCHED_AUDIENCE_IDS_KEY="edkt_matched_audience_ids",Y.MIN_SEQUENCE_LENGTH=8,Y.SAMPLE_RATE=1/256;var R=new(/*#__PURE__*/function(){function e(){this._areAdsSupported=function(){return Promise.resolve(function(e,t){try{var n=Promise.resolve(fetch("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",{method:"HEAD",mode:"no-cors"})).then(function(){return!0})}catch(e){return!1}return n&&n.then?n.then(void 0,function(){return!1}):n}())},this._are3pCookiesSupported=function(){return new Promise(function(e){var t=null,n=document.createElement("iframe");n.id="3pc",n.src="https://cdn.edkt.io/check/index.html",n.style.display="none",n.style.position="fixed",window.addEventListener("message",function r(i){"ag.3pc.supported"!==i.data&&"ag.3pc.unsupported"!==i.data||(t="ag.3pc.supported"===i.data,document.body.removeChild(n),window.removeEventListener("message",r),e(t))},!1),setTimeout(function(){null===t&&(t=!1,document.body.removeChild(n),e(t))},1e3),document.body.appendChild(n)})}}return e.prototype.get=function(){try{var e=this;return Promise.resolve(e._are3pCookiesSupported()).then(function(t){return Promise.resolve(e._areAdsSupported()).then(function(e){return{cs:t,as:e}})})}catch(e){return Promise.reject(e)}},e}());function K(e,t,n){if(!e.s){if(n instanceof G){if(!n.s)return void(n.o=K.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(K.bind(null,e,t),K.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var G=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,n){var r=new e,i=this.s;if(i){var o=1&i?t:n;if(o){try{K(r,1,o(this.v))}catch(e){K(r,2,e)}return r}return this}return this.o=function(e){try{var i=e.v;1&e.s?K(r,1,t?t(i):i):n?K(r,1,n(i)):K(r,2,i)}catch(e){K(r,2,e)}},r},e}();function U(e){return e instanceof G&&1&e.s}var H=function(e){var t=/^\d*$/gi,n=[];return["impId=","AUCTION_ID=","auction_id="].forEach(function(r){var i=e.search(r);if(-1!==i){var o=e.substring(i),u=o.indexOf("&"),s=o.indexOf('"'),a=[];-1!==u&&a.push(u),-1!==s&&a.push(s);var c=Math.min.apply(Math,a),d=o.substring(r.length,c);d&&!n.includes(d)&&t.exec(d)&&n.push(d)}}),n},q=function(t){return Object.values(t).map(function(e){return e.bids}).flat().filter(function(e){return"appnexus"===e.bidderCode}).map(function(t){return e({},t,{buyerAuctionIds:"string"==typeof t.ad?H(t.ad):[]})}).map(function(e){var t=e.appnexus;return{cpm:e.cpm,auctionId:e.auctionId,buyerAuctionIds:e.buyerAuctionIds,creativeId:e.creativeId,buyerMemberId:t?t.buyerMemberId:0}})},W=function(){try{return Promise.resolve(function(){try{var e,t=0,n=function(e,t,n){for(var r;;){var i=e();if(U(i)&&(i=i.v),!i)return o;if(i.then){r=0;break}var o=n();if(o&&o.then){if(!U(o)){r=1;break}o=o.s}}var u=new G,s=K.bind(null,u,2);return(0===r?i.then(c):1===r?o.then(a):(void 0).then(function(){(i=e())?i.then?i.then(c).then(void 0,s):c(i):K(u,1,o)})).then(void 0,s),u;function a(t){o=t;do{if(!(i=e())||U(i)&&!i.v)return void K(u,1,o);if(i.then)return void i.then(c).then(void 0,s);U(o=n())&&(o=o.v)}while(!o||!o.then);o.then(a).then(void 0,s)}function c(e){e?(o=n())&&o.then?o.then(a).then(void 0,s):a(o):K(u,1,o)}}(function(){return!e&&t<10},0,function(){return Promise.resolve(new Promise(function(e){return setTimeout(e,200)})).then(function(){t+=1;try{e=window.pbjs.getBidResponses(),0===Object.keys(e).length&&(e=void 0)}catch(e){}})});return Promise.resolve(n&&n.then?n.then(function(){return e}):e)}catch(e){return Promise.reject(e)}}()).then(function(e){return!!e&&q(e).some(function(e){return 668===e.buyerMemberId})})}catch(e){return Promise.reject(e)}},F=function(t,n,r,i,o){try{var u=window.edktInitializor,s=u.apiKey,a=u.accountId,c=u.publisherId,d=u.loadId,h=O().referer;return Promise.resolve(Promise.all([R.get(),W(),k()])).then(function(u){var f,l,v,p,m=u[0],g=u[1],_=u[2],y=new Y(d).get(g),E=T().length,A=e({url:h,accountId:a,publisherId:c,consentGranted:t,matchedAudiences:n,prober:m},y&&{sequences:y},{featuresAvailable:r,totalPageViews:E,topics:_,documentReferrer:document.referrer,isPagesError:!(null==i||!i.error),pagesErrorCode:null==i||null==(f=i.error)?void 0:f.code,pagesErrorMessage:null==i||null==(l=i.error)?void 0:l.message,isAudiencesError:!(null==o||!o.error),audiencesErrorCode:null==o||null==(v=o.error)?void 0:v.code,audiencesErrorMessage:null==o||null==(p=o.error)?void 0:p.message});return Promise.resolve(V(L,JSON.stringify(A),s,d)).then(function(){})})}catch(e){return Promise.reject(e)}},z=function e(t,n,r){void 0===r&&(r=100);try{var i=function(e,r){try{var i=function(){function e(){var e=function(e,t){return function(n){try{if(!n.bidsReceived||0===n.bidsReceived.length)return Promise.resolve();var r=n.bidsReceived.map(function(e){return function(e){if("appnexus"!==e.bidderCode)return null;var t=H(e.ad),n=e.appnexus;return{cpm:e.cpm,auctionId:e.auctionId,creativeId:e.creativeId,buyerAuctionIds:t.filter(function(e,t,n){return n.indexOf(e)===t&&void 0!==e}),buyerMemberId:n?n.buyerMemberId:0}}(e)}).filter(function(e){return null!=e});return Promise.resolve(V(j,JSON.stringify(r),e,t)).then(function(){})}catch(e){return Promise.reject(e)}}}(t,n);window.pbjs.onEvent("auctionEnd",e)}var r=window.pbjs.getBidResponses(),i=q(r),o=function(){if(i.length>0)return Promise.resolve(V(j,JSON.stringify(i),t,n)).then(function(){})}();return o&&o.then?o.then(e):e()}()}catch(e){return r()}return i&&i.then?i.then(void 0,r):i}(0,function(){var i=function(){if(r>1)return Promise.resolve((i=10*(101-r),new Promise(function(e){return setTimeout(e,i)}))).then(function(){return Promise.resolve(e(t,n,r-1)).then(function(){})});var i}();return i&&i.then?i.then(function(){}):void 0});return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},J=new(/*#__PURE__*/function(){function e(){this.dwellStart=0,this.finished=!1}var t=e.prototype;return t.onDwellEnd=function(e){this.finished||(this.finished=!0,e(Date.now()-this.dwellStart))},t.listen=function(e){var t=this;this.dwellStart=Date.now(),this.finished=!1,window.addEventListener("beforeunload",function(){return t.onDwellEnd(e)}),document.addEventListener("visibilitychange",function(){document.hidden&&t.onDwellEnd(e)},!1)},e}());function B(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}var X=[782],Q=window.edktInitializor||{},$=Q.apiKey||"",Z=Q.accountId||"",ee=Q.publisherId||"",te=["pqIdXN","lKwi7g"].includes(Z)||!!Q.disableGdpr,ne="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});Q.loadId=ne,function(){try{var t=B(function(){return Promise.resolve(function(){try{var t,o=function(o){if(t)return o;function a(t){var o;function a(e){return o?e:Promise.resolve(function(e,t,n,r){try{var i=C();return Promise.resolve(Promise.all([M("https://api.edkt.io/nexus/edkt/pages?accId="+t+"&pubId="+n+"&url="+encodeURIComponent(i),e,r),Promise.resolve({error:void 0,data:[]})])).then(function(e){var t=e[0],n=e[1];return{pagesResponse:{error:t.error,data:t.data},audiencesResponse:{error:n.error,data:n.data}}})}catch(e){return Promise.reject(e)}}($,Z,ee,ne)).then(function(e){var t,o,a,c=e.pagesResponse,d=e.audiencesResponse;return D("pagesResponse: ",c),D("audiencesResponse: ",d),Promise.resolve((a={pageFeatures:null==(t=c.data)?void 0:t.features,pageMetadata:null==(o=c.data)?void 0:o.metadata,audienceDefinitions:d.data||[],vendorIds:X,omitGdprConsent:te},n(void 0,void 0,void 0,function(){var e,t,n,o,u,c,d,h;return r(this,function(r){switch(r.label){case 0:return e=a.vendorIds,t=a.pageFeatures,n=a.pageMetadata,o=a.audienceDefinitions,u=a.featureStorageSize,a.omitGdprConsent?[3,2]:[4,P(e)];case 1:if(!r.sent())return[2];r.label=2;case 2:return l.setStorageSize(u),l.savePageView(t,n),c=l.getCopyOfPageViews(),v.unsetAudiencesIfVersionIncremented(o),d=o.filter(function(e){return!v.isMatched(e.id,e.version)}),h=function(e,t){var n=s();return e.reduce(function(e,r){var o;return function(e,t){try{var n=e.filter,r=e.rules;if(0===t.length||0===n.queries.length)return!1;var i=t.filter(function(e){return n.queries.some(function(t){return function(e,t){return!(!t||!function(e,t){return t.version===e.featureVersion}(e,t))&&[E,A].some(function(n){return n(e,t)})}(t,e.features[t.queryProperty])})});return r.every(function(e){var t=p[e.reducer.name]()(i);return m[e.matcher.name](e.matcher.args)(t)})}catch(e){return!1}}({filter:{any:!1,queries:(o=r).definition},rules:[{reducer:{name:"count"},matcher:{name:"gt",args:o.occurrences}}]},t.filter(function(e){return 0===r.lookBack||e.ts>n-r.lookBack}))?i(e,[{id:r.id,version:r.version,matchedAt:n,expiresAt:n+r.ttl,matchedOnCurrentPageView:!0}]):e},[])}(d,c),v.setAudiences(h),[2]}})}))).then(function(){var e,t,n,r,i,o,s=null==(e=c.data)?void 0:e.ma;if(Array.isArray(s)&&s.length>0){var a=(n=s,r=b(),i=Math.round(Date.now()/1e3),o=r.reduce(function(e,t){return e[t.id]=t,e},{}),n.map(function(e){var t={id:e.id,version:0,matchedAt:i,expiresAt:i+e.ttl,matchedOnCurrentPageView:!0},n=o[e.id];return n&&(t.version=n.version,t.matchedAt=n.matchedAt,t.expiresAt=n.matchedAt+e.ttl,t.matchedOnCurrentPageView=n.matchedOnCurrentPageView),t}));v.setAudiences(a)}return D("matchedAudiences: ",b()),Promise.resolve(Promise.all([z($,ne),F(u,b(),null==(t=c.data)?void 0:t.featuresAvailable,c,d)])).then(function(){J.listen(function(e){return function(e){var t=window.edktInitializor.loadId;!function(e,t){try{navigator.sendBeacon("https://api.edkt.io/analytics/dwell",t)}catch(e){D("Beacon Error:",e)}}(0,JSON.stringify({loadId:t,dwellTime:e}))}(e)})})})})}u=t;var c=function(){if(!u)return Promise.resolve(F(u,b(),!1)).then(function(){D("Waited for consent, not granted",e({},Q.debug)),o=1})}();return c&&c.then?c.then(a):a(c)}return u?a(!0):Promise.resolve(P(X)).then(a)},u=!1;Q.debug={omitGdprConsent:te,hasConsent:u,VERSION:"0.0.0-alpha.540",EDKT_VERSION:"0.0.0-dev.42"};var a=function(){if(!te){var i,o=function(n){return t?n:function(){if(!u&&!(n=i).hasConsent&&function(e){return"tcloaded"===e.eventStatus||"useractioncomplete"===e.eventStatus}(n))return Promise.resolve(F(i.hasConsent,b(),!1)).then(function(){D("No consent granted",e({},Q.debug)),t=1});var n}()},s=B(function(){return Promise.resolve(function(e){return void 0===e&&(e=[]),n(void 0,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,S()];case 1:return t.sent(),[2,new Promise(function(t,n){window.__tcfapi?window.__tcfapi("addEventListener",2,function(n,r){if(r&&"loaded"===n.cmpStatus){var i=I(e,n);t({eventStatus:n.eventStatus,hasConsent:i}),w(n)}}):n(new Error("TCF API is missing"))})]}})})}(X)).then(function(e){i=e})},function(e){throw new Error(e.message)});return s&&s.then?s.then(o):o(s)}u=!0}();return Promise.resolve(a&&a.then?a.then(o):o(a))}catch(e){return Promise.reject(e)}}()).then(function(){})},function(e){return Promise.resolve(function(e,t,n,r){try{return Promise.resolve(V("https://api.edkt.io/analytics/error",JSON.stringify({version:"0.0.0-alpha.540",name:n.name,message:n.message,stack:n.stack,url:C()}),t,e)).then(function(){})}catch(e){return Promise.reject(e)}}(ne,$,e)).then(function(){})});t&&t.then&&t.then(function(){})}catch(e){Promise.reject(e)}}()});
//# sourceMappingURL=edgekit.min.js.map
